{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ profile_user.get_full_name|default:profile_user.username }}'s Profile | Online Homework System</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
      body { font-family: 'Inter', 'Poppins', Arial, sans-serif; background: #f5f6fa; margin: 0; }
      .cover-photo { width: 100%; height: 140px; background: linear-gradient(120deg, #e0ecff 60%, #b3c6f7 100%); position: relative; }
      .profile-avatar-mobile { width: 110px; height: 110px; border-radius: 50%; object-fit: cover; border: 4px solid #fff; position: absolute; left: 50%; bottom: -55px; transform: translateX(-50%); box-shadow: 0 2px 12px #2F80ED22; background: #e3eafc; }
      .profile-header-mobile { text-align: center; margin-top: 70px; margin-bottom: 1.2em; }
      .profile-header-mobile h2 { font-size: 1.5em; font-weight: 700; color: #2F80ED; margin-bottom: 0.2em; }
      .profile-header-mobile .role-badge { display:inline-block; background: #06D6A0; color: #fff; font-size: 0.98rem; font-weight: 600; border-radius: 6px; padding: 0.2em 0.9em; margin-bottom: 0.5em; }
      .followers-following-mobile { display: flex; justify-content: center; gap: 1.5em; margin-bottom: 0.7em; }
      .followers-following-mobile span { font-weight: 600; color: #2F80ED; font-size: 1.05em; }
      .follower-avatars-row { display: flex; justify-content: center; gap: 0.2em; margin-bottom: 1em; overflow-x: auto; }
      .follower-avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; box-shadow: 0 1px 4px #2F80ED22; background: #e3eafc; }
      .profile-actions-mobile { display: flex; justify-content: center; gap: 0.7em; margin-bottom: 1.2em; }
      .ohw-btn, .ohw-btn-primary, .follow-btn { border:none; border-radius:8px; padding:0.6em 1.3em; font-size:1em; font-weight:600; background:#2F80ED; color:#fff; cursor:pointer; transition:background 0.18s, box-shadow 0.18s; box-shadow:0 2px 8px #2F80ED22; text-decoration:none; }
      .ohw-btn:hover, .ohw-btn-primary:hover, .follow-btn:hover { background:#1c5db6; color:#fff; }
      .follow-btn.unfollow { background: #888; }
      .profile-tabs { display: flex; justify-content: center; gap: 1.2em; margin-bottom: 1.2em; border-bottom: 1.5px solid #e3eafc; }
      .profile-tab { font-weight: 600; color: #2F80ED; background: none; border: none; padding: 0.7em 0.5em; font-size: 1.08em; cursor: pointer; border-bottom: 2.5px solid transparent; transition: border 0.18s; }
      .profile-tab.active, .profile-tab:focus { border-bottom: 2.5px solid #2F80ED; color: #1c5db6; outline: none; }
      .profile-section-card { background: #fff; border-radius: 14px; box-shadow: 0 2px 12px #2F80ED0A; padding: 1.2em 1.2em 0.5em 1.2em; margin-bottom: 1.2em; }
      .intro-list { list-style: none; padding: 0; margin: 0; }
      .intro-list li { display: flex; align-items: center; gap: 0.7em; margin-bottom: 0.7em; color: #444; font-size: 1.05em; }
      .intro-list i { color: #2F80ED; font-size: 1.2em; }
      .user-post-card { background: #f7faff; border-radius: 12px; box-shadow: 0 2px 8px #2F80ED0A; padding: 1.2em 1.2em 0.5em 1.2em; margin-bottom: 1.2em; }
      .user-post-card:last-child { margin-bottom: 0; }
      @media (min-width: 600px) {
        .profile-header-mobile h2 { font-size: 2em; }
        .profile-container { max-width: 480px; margin: 2.5rem auto; }
      }
      .bottom-nav a.active {
        color: #1c5db6;
        position: relative;
      }
      .bottom-nav a.active::after {
        content: '';
        display: block;
        margin: 0 auto;
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: #1c5db6;
        margin-top: 2px;
      }
      .section-nav {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 2.5em;
        background: #fff;
        border-bottom: 1.5px solid #e3eafc;
        box-shadow: 0 2px 12px #2F80ED11;
        padding: 0.5em 0 0.2em 0;
        font-size: 1.13em;
        z-index: 1050;
        position: fixed;
        top: 56px;
        left: 0;
        width: 100vw;
      }
      .section-nav a {
        color: #2F80ED;
        text-decoration: none;
        font-weight: 600;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0.2em 0.7em;
        border-radius: 8px 8px 0 0;
        transition: background 0.18s, color 0.18s;
        position: relative;
      }
      .section-nav a.active, .section-nav a:focus {
        color: #1c5db6;
        background: #e3eafc;
      }
      .section-nav a.active::after {
        content: '';
        display: block;
        margin: 0 auto;
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: #1c5db6;
        margin-top: 2px;
      }
      .section-nav .nav-label {
        font-size: 0.92em;
        margin-top: 0.1em;
      }
      @media (max-width: 900px) {
        .section-nav { display: none; }
        .profile-container { margin-top: 0; }
      }
    </style>
</head>
<body>
    <!-- Bootstrap Navbar Start -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
      <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="/">NawaPrativa</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="/gallery/">Gallery</a></li>
            <li class="nav-item"><a class="nav-link" href="/faculty/">Faculty</a></li>
            <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
            <li class="nav-item"><a class="nav-link" href="/contact/">Contact</a></li>
            <li class="nav-item"><a class="nav-link" href="/notices/">Notices</a></li>
            <li class="nav-item"><a class="nav-link" href="/results/">Results</a></li>
            <li class="nav-item"><a class="nav-link" href="/profile/">Profile</a></li>
            {% if user.is_authenticated %}
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="accountDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="{% if user.student_profile and user.student_profile.profile_photo %}{{ user.student_profile.profile_photo.url }}{% elif user.teacher_profile and user.teacher_profile.photo %}{{ user.teacher_profile.photo.url }}{% else %}{% static 'images/avatar-default.png' %}{% endif %}" alt="avatar" style="width:32px;height:32px;border-radius:50%;object-fit:cover;margin-right:0.5em;">
                {{ user.get_full_name|default:user.username }}
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="accountDropdown">
                <li><h6 class="dropdown-header">Signed in as<br><span class="fw-bold">{{ user.get_full_name|default:user.username }}</span></h6></li>
                <li><a class="dropdown-item" href="/dashboard/">Dashboard</a></li>
                <li><a class="dropdown-item" href="/profile/">Profile</a></li>
                <li><a class="dropdown-item" href="/my-details/">My Details</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="/logout/">Logout</a></li>
              </ul>
            </li>
            {% else %}
            <li class="nav-item"><a class="nav-link" href="/login/">Login</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'student_signup_page' %}">Sign Up</a></li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
    <!-- Bootstrap Navbar End -->
  <div class="profile-container">
    <div style="position:relative;">
      <div class="cover-photo" style="background-image: url('{% if student and student.cover_photo %}{{ student.cover_photo.url }}{% elif teacher and teacher.cover_photo %}{{ teacher.cover_photo.url }}{% endif %}'); background-size: cover; background-position: center;"></div>
      <img src="{% if student and student.profile_photo %}{{ student.profile_photo.url }}{% elif teacher and teacher.photo %}{{ teacher.photo.url }}{% else %}{% static 'images/gallery/schoolslogo.jpg' %}{% endif %}" alt="Profile Photo" class="profile-avatar-mobile" style="z-index:2;">
    </div>
    <div class="profile-header-mobile" style="margin-top:65px;">
      <h2>{{ profile_user.get_full_name|default:profile_user.username }}</h2>
      {% if student %}
        <div class="role-badge">Student</div>
      {% elif teacher %}
        <div class="role-badge">Teacher</div>
      {% endif %}
      <div class="followers-following-mobile">
        <span>{{ followers.count }} Followers</span>
        <span>{{ following.count }} Following</span>
      </div>
      <div class="follower-avatars-row">
        {% for f in followers|slice:':7' %}
          <img src="{% if f.follower.student_profile and f.follower.student_profile.profile_photo %}{{ f.follower.student_profile.profile_photo.url }}{% elif f.follower.teacher_profile and f.follower.teacher_profile.photo %}{{ f.follower.teacher_profile.photo.url }}{% else %}{% static 'images/avatar-default.png' %}{% endif %}" class="follower-avatar" alt="follower">
        {% endfor %}
      </div>
      <div class="profile-actions-mobile">
        {% if user.is_authenticated and user != profile_user %}
          <form method="post" action="" style="display:inline;">
            {% csrf_token %}
            {% if is_friend %}
              <span class="ohw-btn-primary" style="background:#06D6A0;cursor:default;">Friends</span>
            {% elif is_following %}
              <button class="follow-btn unfollow" name="action" value="unfollow">Unfollow</button>
            {% elif is_following_back %}
              <button class="follow-btn" name="action" value="follow">Follow Back</button>
            {% else %}
              <button class="follow-btn" name="action" value="follow">Follow</button>
            {% endif %}
          </form>
        {% elif user == profile_user %}
          <a href="/profile/edit/" class="ohw-btn-primary">Edit Profile</a>
        {% endif %}
      </div>
    </div>
    <div class="profile-tabs">
      <button class="profile-tab active" id="tab-posts" onclick="showTab('posts')">Posts</button>
      <button class="profile-tab" id="tab-about" onclick="showTab('about')">About</button>
      <button class="profile-tab" id="tab-friends" onclick="showTab('friends')">Friends</button>
    </div>
    <div id="profile-section-posts" class="profile-section-card">
      <h4 style="color:#2F80ED; font-weight:700; margin-bottom:1em;">Posts & Status Updates</h4>
      {% for post in posts %}
        <div class="user-post-card">
          <div style="font-weight:600; color:#2F80ED;">Post</div>
          <div style="margin:0.5em 0;">{{ post.text }}</div>
          {% if post.image %}<img src="{{ post.image.url }}" style="max-width:100%;border-radius:8px;">{% endif %}
          <div style="font-size:0.95em; color:#888; margin-top:0.5em;">{{ post.created_at|date:'M d, Y H:i' }}</div>
        </div>
      {% endfor %}
      {% for status in statuses %}
        <div class="user-post-card">
          <div style="font-weight:600; color:#06D6A0;">Status</div>
          <div style="margin:0.5em 0;">{{ status.text }}</div>
          {% if status.image %}<img src="{{ status.image.url }}" style="max-width:100%;border-radius:8px;">{% endif %}
          <div style="font-size:0.95em; color:#888; margin-top:0.5em;">{{ status.created_at|date:'M d, Y H:i' }}</div>
        </div>
      {% endfor %}
      {% if not posts and not statuses %}
        <div class="text-muted">No posts or status updates yet.</div>
      {% endif %}
    </div>
    <div id="profile-section-about" class="profile-section-card" style="display:none;">
      <h4 style="color:#2F80ED; font-weight:700; margin-bottom:1em;">Intro</h4>
      <ul class="intro-list">
        {% if student %}
          <li><i class="fas fa-user-graduate"></i> {{ student.full_name }}</li>
          <li><i class="fas fa-chalkboard"></i> Class: {{ student.student_class }}</li>
          <li><i class="fas fa-id-card"></i> Symbol: {{ student.symbol_number }}</li>
          <li><i class="fas fa-venus-mars"></i> Gender: {{ student.gender }}</li>
          <li><i class="fas fa-birthday-cake"></i> DOB: {{ student.date_of_birth }}</li>
          <li><i class="fas fa-user"></i> Parent: {{ student.parent_name }}</li>
          <li><i class="fas fa-phone"></i> Parent Contact: {{ student.parent_contact }}</li>
          <li><i class="fas fa-phone-alt"></i> Phone: {{ student.phone_number }}</li>
          <li><i class="fas fa-map-marker-alt"></i> Address: {{ student.address }}</li>
        {% elif teacher %}
          <li><i class="fas fa-user-tie"></i> {{ teacher.full_name }}</li>
          <li><i class="fas fa-book"></i> Subject: {{ teacher.subject }}</li>
          <li><i class="fas fa-school"></i> School: {{ teacher.school_name }}</li>
          <li><i class="fas fa-briefcase"></i> Position: {{ teacher.position }}</li>
          <li><i class="fas fa-graduation-cap"></i> Education: {{ teacher.education }}</li>
          <li><i class="fas fa-phone"></i> Contact: {{ teacher.contact_number }}</li>
          <li><i class="fas fa-tint"></i> Blood Group: {{ teacher.blood_group }}</li>
          <li><i class="fas fa-map-marker-alt"></i> Address: {{ teacher.address }}</li>
        {% endif %}
      </ul>
    </div>
    <div id="profile-section-friends" class="profile-section-card" style="display:none;">
      <h4 style="color:#2F80ED; font-weight:700; margin-bottom:1em;">Friends</h4>
      <div style="display:flex;flex-wrap:wrap;gap:1em;">
        {% for friend in friends %}
          <a href="/profile/{{ friend.username }}/" style="text-align:center;text-decoration:none;color:#222;width:80px;">
            <img src="{% if friend.student_profile and friend.student_profile.profile_photo %}{{ friend.student_profile.profile_photo.url }}{% elif friend.teacher_profile and friend.teacher_profile.photo %}{{ friend.teacher_profile.photo.url }}{% else %}{% static 'images/avatar-default.png' %}{% endif %}" style="width:60px;height:60px;border-radius:50%;object-fit:cover;margin-bottom:0.3em;">
            <div style="font-size:0.98em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">{{ friend.get_full_name|default:friend.username }}</div>
          </a>
        {% empty %}
          <div class="text-muted">No friends yet.</div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="bottom-nav">
  <ul>
    <li><a href="/feed/" class="{% if request.path == '/feed/' %}active{% endif %}"><i class="fas fa-home"></i><span class="nav-label">Feed</span></a></li>
    <li><a href="/homework/" class="{% if request.path == '/homework/' %}active{% endif %}"><i class="fas fa-book"></i><span class="nav-label">Homework</span></a></li>
    <li><a href="/notes/" class="{% if request.path == '/notes/' %}active{% endif %}"><i class="fas fa-file-alt"></i><span class="nav-label">Notes</span></a></li>
    <li><a href="/dashboard/" class="{% if request.path == '/dashboard/' %}active{% endif %}"><i class="fas fa-chart-bar"></i><span class="nav-label">Dashboard</span></a></li>
    <li><a href="/profile/" class="{% if request.path == '/profile/' %}active{% endif %}"><i class="fas fa-user"></i><span class="nav-label">Profile</span></a></li>
  </ul>
</div>
  <script src="https://kit.fontawesome.com/2c36e9b7b1.js" crossorigin="anonymous"></script>
  <script src="{% static 'js/main.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function showTab(tab) {
      document.getElementById('profile-section-posts').style.display = (tab === 'posts') ? '' : 'none';
      document.getElementById('profile-section-about').style.display = (tab === 'about') ? '' : 'none';
      document.getElementById('profile-section-friends').style.display = (tab === 'friends') ? '' : 'none';
      document.getElementById('tab-posts').classList.toggle('active', tab === 'posts');
      document.getElementById('tab-about').classList.toggle('active', tab === 'about');
      document.getElementById('tab-friends').classList.toggle('active', tab === 'friends');
    }
  </script>
</body>
</html>